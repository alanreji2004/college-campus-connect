const jwt = require('jsonwebtoken');const config = require('../config');const db = require('../models/db'); async function authMiddleware(req, res, next) {  const authHeader = req.headers.authorization;  let token = null;  if (authHeader && authHeader.startsWith('Bearer ')) {    token = authHeader.slice(7);  }  if (!token) {    return res.status(401).json({ message: 'Authentication token missing' });  }  try {    const decoded = jwt.verify(token, config.jwt.secret);    try {      const userResult = await db.query('SELECT * FROM users WHERE id = $1', [decoded.sub]);      const user = userResult.rows[0];      if (user) {        req.user = {          ...decoded,          id: decoded.sub,          ...user,          roles: user.roles || []         };      } else {        req.user = { ...decoded, id: decoded.sub };      }    } catch (dbError) {      console.error('Error fetching user details:', dbError);      req.user = { ...decoded, id: decoded.sub };    }    return next();  } catch (err) {    console.error('JWT Verification Error:', err.message);    return res.status(401).json({ message: 'Invalid or expired token' });  }}module.exports = authMiddleware;