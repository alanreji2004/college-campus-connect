const express = require('express'); const cors = require('cors'); const helmet = require('helmet'); const config = require('./config'); const { requestLogger } = require('./utils/logger'); const { notFoundHandler, errorHandler } = require('./middlewares/errorHandler'); const sanitize = require('./middlewares/sanitize'); const { apiLimiter } = require('./middlewares/rateLimit'); const dashboardRoutes = require('./routes/dashboardRoutes'); const attendanceRoutes = require('./routes/attendanceRoutes'); const deviceRoutes = require('./routes/deviceRoutes'); const aiRoutes = require('./routes/aiRoutes'); const analyticsRoutes = require('./routes/analyticsRoutes');const adminRoutes = require('./routes/adminRoutes'); const app = express(); app.use(helmet({ contentSecurityPolicy: false })); app.use(cors({ origin: config.cors.origin, credentials: true })); app.use(express.json()); app.use(sanitize); app.use('/api', apiLimiter); app.use(requestLogger); app.get('/health', (req, res) => { res.json({ status: 'ok', service: 'campus-connect-server' }); }); app.use('/api/dashboard', dashboardRoutes); app.use('/api/attendance', attendanceRoutes); app.use('/api/devices', deviceRoutes); app.use('/api/ai', aiRoutes); app.use('/api/analytics', analyticsRoutes);app.use('/api/admin', adminRoutes); app.use(notFoundHandler); app.use(errorHandler); module.exports = app;